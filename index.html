<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pair Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background-color: #f2f2f2;
      color: #000000;
      display: flex;
    }

    /* Navigation sidebar */
    .nav-sidebar {
      width: 80px;
      background-color: #ffffff;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
      gap: 20px;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
      z-index: 1000;
    }

    .nav-button {
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 12px;
      transition: background-color 0.2s ease;
      position: relative;
      font-size: 24px;
    }

    .nav-button:hover {
      background-color: #f0f0f0;
    }

    .nav-button.active {
      background-color: #007bff;
      color: #ffffff;
    }

    .nav-button.active:hover {
      background-color: #0064cc;
    }

    /* Main content area */
    .main-content {
      margin-left: 80px;
      width: calc(100% - 80px);
      min-height: 100vh;
    }

    .page-view {
      display: none;
    }

    .page-view.active {
      display: block;
    }

    .page-wrapper {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 16px 48px;
    }

    h1 {
      margin-top: 0;
      margin-bottom: 24px;
      font-size: 28px;
      font-weight: 600;
    }

    .columns {
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
    }

    .left-column {
      width: 50%;
      padding-right: 16px;
    }

    .right-column {
      width: 50%;
      padding-left: 16px;
    }

    .card {
      background-color: #ffffff;
      border-radius: 14px;
      padding: 20px 24px 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 6px;
    }

    input[type="text"],
    select {
      width: 100%;
      padding: 8px 10px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #d0d0d0;
      background-color: #fafafa;
      color: inherit;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease,
        background-color 0.15s ease;
    }

    input[type="text"]:focus,
    select:focus {
      border-color: #007bff;
      box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.15);
      background-color: #ffffff;
    }

    .field-group {
      margin-bottom: 14px;
    }

    .status-message {
      margin-top: 6px;
      font-size: 14px;
      font-weight: 500;
    }

    .status-success {
      color: #2e7d32; /* green */
    }

    .status-error {
      color: #b71c1c; /* dark red */
    }

    .selectors-row {
      display: flex;
      gap: 10px;
      margin-bottom: 14px;
    }

    .selectors-row > div {
      flex: 1;
    }

    .actions-row {
      margin-top: 6px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.15s ease, transform 0.05s ease,
        box-shadow 0.15s ease;
    }

    button:active:not(:disabled) {
      transform: translateY(1px);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) inset;
    }

    #guessButton {
      background-color: #c9c9c9;
      color: #444444;
      cursor: not-allowed;
    }

    #guessButton.enabled {
      background-color: #007bff;
      color: #ffffff;
      cursor: pointer;
    }

    #guessButton.enabled:hover {
      background-color: #0064cc;
    }

    #validateButton {
      background-color: #c9c9c9;
      color: #444444;
      cursor: not-allowed;
    }

    #validateButton:enabled {
      background-color: #28a745;
      color: #ffffff;
      cursor: pointer;
    }

    #validateButton:enabled:hover {
      background-color: #218838;
    }

    .helper-text {
      font-size: 12px;
      color: #666666;
      margin-top: 4px;
    }

    .refresh-button {
      background-color: #007bff;
      color: #ffffff;
      cursor: pointer;
      margin-bottom: 16px;
    }

    .refresh-button:hover {
      background-color: #0064cc;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 12px;
    }

    .data-table th {
      background-color: #d3d3d3;
      padding: 8px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
      border: 1px solid #c0c0c0;
    }

    .data-table td {
      padding: 8px;
      font-size: 14px;
      border: 1px solid #e0e0e0;
    }

    .last-refreshed {
      font-size: 12px;
      color: #4a4a4a;
      margin-top: 8px;
    }

    .table-placeholder {
      font-size: 14px;
      color: #666666;
      padding: 16px 0;
      text-align: center;
    }

    /* Table of Contents page specific styles */
    .toc-container {
      padding: 20px;
      min-height: 100vh;
    }

    .toc-link {
      font-family: monospace;
      font-size: 14px;
      color: #007bff;
      text-decoration: none;
      display: inline-block;
      padding: 8px 0;
    }

    .toc-link:hover {
      text-decoration: underline;
    }

    /* Placeholder pages */
    .placeholder-container {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      font-size: 24px;
      color: #666666;
    }

    /* Password protection styles */
    .password-overlay {
      position: fixed;
      top: 0;
      left: 80px;
      right: 0;
      bottom: 0;
      background-color: #808080;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .password-dialog {
      background-color: #ffffff;
      border-radius: 8px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      min-width: 320px;
    }

    .password-dialog input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #d0d0d0;
      background-color: #fafafa;
      outline: none;
      box-sizing: border-box;
    }

    .password-dialog input[type="text"]:focus {
      border-color: #007bff;
      box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.15);
      background-color: #ffffff;
    }

    /* Trinity symbol for page 4 */
    .trinity-symbol {
      font-size: 24px;
      line-height: 1;
      display: inline-block;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    @media (max-width: 900px) {
      .columns {
        flex-direction: column;
      }
      .left-column {
        width: 100%;
        padding-right: 0;
      }
      .right-column {
        width: 100%;
        padding-left: 0;
      }
      .nav-sidebar {
        width: 60px;
      }
      .main-content {
        margin-left: 60px;
        width: calc(100% - 60px);
      }
      .nav-button {
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation Sidebar -->
  <div class="nav-sidebar">
    <div class="nav-button active" data-page="1" title="Table of Contents">
      ★
    </div>
    <div class="nav-button" data-page="2" title="Star">
      ①
    </div>
    <div class="nav-button" data-page="3" title="Pair">
      ②
    </div>
    <div class="nav-button" data-page="4" title="Links">
      ③
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Page 1: Table of Contents -->
    <div class="page-view active" id="page1">
      <div class="toc-container">
        <a href="https://drive.google.com/file/d/11pcnsO4uNOerLy9b8kZroxnfFWZRXQ2T/view?usp=sharing" 
           target="_blank" 
           class="toc-link">
          Table of Contents
        </a>
      </div>
    </div>

    <!-- Page 2: Star (Placeholder) -->
    <div class="page-view" id="page2">
      <div style="padding: 20px; font-family: monospace; font-size: 14px; text-align: left;">
        <div>Michigan</div>
        <div>Mississippi</div>
        <div>Norris</div>
        <div>Prairie</div>
      </div>
    </div>

    <!-- Page 3: Pair Checker -->
    <div class="page-view" id="page3">
      <div class="page-wrapper">
        <div class="columns">
      <div class="left-column">
        <!-- Card 1: One-Time Use Code -->
        <div class="card">
          <div class="card-title">One-Time Use Code</div>

          <div class="field-group">
            <input
              type="text"
              id="codeInput"
              autocomplete="off"
              placeholder="Enter your one-time use code"
              maxlength="15"
            />
            <div id="codeStatus" class="status-message"></div>
          </div>
          <div class="actions-row">
            <button id="validateButton" disabled>Validate Code</button>
          </div>
        </div>

        <!-- Card 2: Pair Selection -->
        <div class="card">
          <div class="card-title">Pair Selection Checker</div>
          <div class="helper-text" style="margin-bottom: 12px;">
            The button to check your guess is enabled only when a valid code has been verified and
            two different entries are selected.
          </div>

          <div class="selectors-row">
            <div class="field-group">
              <label for="selectOne">Barrel Jack 1</label>
              <select id="selectOne">
                <option value="">— Select —</option>
              </select>
            </div>

            <div class="field-group">
              <label for="selectTwo">Barrel Jack 2</label>
              <select id="selectTwo">
                <option value="">— Select —</option>
              </select>
            </div>
          </div>

          <div class="actions-row">
            <button id="guessButton" disabled>Check Pair</button>
            <div id="guessStatus" class="status-message"></div>
          </div>
        </div>
      </div>

      <!-- Right Column: Check Guesses Remaining -->
      <div class="right-column">
        <div class="card">
          <div class="card-title">Check Guesses Remaining</div>
          
          <button id="refreshDataButton" class="refresh-button">Check Code Use</button>
          
          <div id="tablePlaceholder" class="table-placeholder">
            Click the button to retrieve a record of past code usage.
          </div>
          
          <table class="data-table" id="dataTable" style="display: none;">
            <thead>
              <tr>
                <th>Code</th>
                <th>Date Used</th>
                <th>Item 1</th>
                <th>Item 2</th>
              </tr>
            </thead>
            <tbody id="dataTableBody">
            </tbody>
          </table>
          
          <div id="lastRefreshed" class="last-refreshed" style="display: none;"></div>
        </div>
        </div>
      </div>
      </div>
    </div>

    <!-- Page 4: Links -->
    <div class="page-view" id="page4">
      <div style="padding: 20px; font-family: monospace; font-size: 14px; text-align: left;">
        <div>Aurora</div>
        <div>Brentwood</div>
        <div>Mississippi</div>
        <div>Zion</div>
      </div>
    </div>
  </div>

  <script>
    // ================= CONFIGURATION =================
    // Replace this with your deployed Google Apps Script web app URL.
    // Your Apps Script can use e.parameter.action to distinguish actions:
    //   action=validateCode   -> check one-time code and mark used if valid
    //   action=checkPair      -> check whether a given pair is correct
    //
    // Expected JSON responses (examples):
    //   { "result": "valid" }         // for validateCode
    //   { "result": "used" }
    //   { "result": "invalid" }
    //
    //   { "result": "correct" }       // for checkPair
    //   { "result": "incorrect" }
    //
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxnMDgSdw1sVuEthtah32um53br-9qtMgJoPqhEfcq25fFmblazqsN1EFYMjwx7cP47/exec";

    // Password configuration for each page
    const PAGE_PASSWORDS = {
      '1': 'ferrari',
      '2': 'honda',
      '3': 'dodge',
      '4': 'subaru'
    };

    const PAGE_NAMES = {
      '1': 'Hint 1',
      '2': 'Hint 2',
      '3': 'Hint 3',
      '4': 'Hint 4'
    };

    // Track which pages have been unlocked
    // Page 1 (Table of Contents) starts unlocked since it's the initial page
    let unlockedPages = {
      '1': true
    };

    // ================= DATA: WORDS / PHRASES =================
    const entries = [
      "55",
      "1884",
      "6333",
      "(7-5) + (15-7)",
      "05/09/13",
      "19/22/25",
      "23rd",
      "2A Region 3",
      "3 to Broad to 278 to 1",
      "3rd",
      "61%",
      "Aurora",
      "Aximili",
      "Bank of America Plaza",
      "BENTO",
      "Bishop",
      "Brentwood",
      "Cañon City",
      "Canyon",
      "Chuy",
      "Cliff",
      "Colima",
      "Darkwing Duck",
      "December",
      "Deer",
      "Delaware",
      "Delta",
      "Desert Rose",
      "Eagles",
      "Egypt",
      "Eiffel 65",
      "Elkhorn",
      "Falcon",
      "Florida",
      "Four-Way Test",
      "Friendsgiving",
      "Gabriel",
      "Game Keeper",
      "Gary",
      "Gator Skater",
      "Gerald Schultz",
      "Goku",
      "Gold H",
      "Harvard",
      "Heiser",
      "Hot Mama's Chilled Ice",
      "Jaquval",
      "Jardin Núñez",
      "Karminee",
      "La-No-Che Rash",
      "LAX",
      "Leak",
      "Let It Be",
      "March",
      "Marlin",
      "McCutcherson",
      "Miles",
      "Mine That Bird",
      "Mississippi",
      "Morès",
      "Mosh Pit",
      "Munson",
      "Oak",
      "PacSun",
      "Panera & Moe's  & Cold Stone",
      "Panther",
      "Penny Lane",
      "Polk",
      "Power 9",
      "Prairie",
      "PS1",
      "Ravnica",
      "Rawlings",
      "Red Alert",
      "Reunion",
      "Robber",
      "Rock Against Bush, Vol. 2",
      "Satarino",
      "Sci-Fi City",
      "Seeker",
      "Seven Major Changes",
      "Sharky",
      "Silver Moon",
      "Speech",
      "Stump",
      "TAG",
      "Texas",
      "That Is So Cooooooool!",
      "The Beat",
      "Tipisa",
      "Titan",
      "Treaty",
      "Trinity",
      "Trumpet",
      "Virginia",
      "Volcán",
      "Ward",
      "Warrington",
      "Warwick",
      "We Survived the Class of '05",
      "Wicked Game",
      "WOW",
      "Xanga",
      "Yorktown",
      "Zero Miles",
      "Zion"
    ];

    // ================= APP LOGIC =================
    let codeIsValid = false;
    let currentCode = "";
    let codeInput, codeStatus, validateButton, selectOne, selectTwo, guessButton, guessStatus, refreshDataButton, lastRefreshed;

    // Populate both selectors with entries
    function populateSelectors() {
      entries.forEach((item) => {
        const opt1 = document.createElement("option");
        opt1.value = item;
        opt1.textContent = item;
        selectOne.appendChild(opt1);

        const opt2 = document.createElement("option");
        opt2.value = item;
        opt2.textContent = item;
        selectTwo.appendChild(opt2);
      });
    }

    function setCodeStatus(message, type) {
      codeStatus.textContent = message || "";
      codeStatus.classList.remove("status-success", "status-error");
      if (type === "success") {
        codeStatus.classList.add("status-success");
      } else if (type === "error") {
        codeStatus.classList.add("status-error");
      }
    }

    function setGuessStatus(message, type) {
      guessStatus.textContent = message || "";
      guessStatus.classList.remove("status-success", "status-error");
      if (type === "success") {
        guessStatus.classList.add("status-success");
      } else if (type === "error") {
        guessStatus.classList.add("status-error");
      }
    }

    // Enable / disable Guess button based on rules
    function updateGuessButtonState() {
      const val1 = selectOne.value;
      const val2 = selectTwo.value;
      const canGuess =
        codeIsValid && val1 && val2 && val1 !== val2;

      guessButton.disabled = !canGuess;
      guessButton.classList.toggle("enabled", canGuess);
    }

    // Check if code is valid 15-digit alphanumeric
    function isValidCodeFormat(code) {
      return /^[a-zA-Z0-9]{15}$/.test(code);
    }

    // Enable / disable Validate button based on code format
    function updateValidateButtonState() {
      const code = codeInput.value.trim();
      validateButton.disabled = !isValidCodeFormat(code);
    }

    // Validate code via Apps Script
    async function validateCode() {
      const code = codeInput.value.trim();
      currentCode = code;
      codeIsValid = false;
      setGuessStatus("", null);
      updateGuessButtonState();

      if (!code) {
        setCodeStatus("", null);
        return;
      }

      try {
        const url =
          SCRIPT_URL +
          "?action=validateCode&code=" +
          encodeURIComponent(code);
        const response = await fetch(url);
        const data = await response.json();

        if (data.result === "valid") {
          codeIsValid = true;
          setCodeStatus("Code validated.", "success");
        } else if (data.result === "used") {
          setCodeStatus(
            "Code previously used. Not valid for use.",
            "error"
          );
        } else {
          setCodeStatus(
            "Code could not be validated. Please try again.",
            "error"
          );
        }
      } catch (err) {
        console.error(err);
        setCodeStatus(
          "There was a problem validating the code. Please try again.",
          "error"
        );
      } finally {
        updateGuessButtonState();
      }
    }

    // Submit a guess via Apps Script
    async function submitGuess() {
      const first = selectOne.value;
      const second = selectTwo.value;

      if (!first || !second || first === second || !codeIsValid) {
        updateGuessButtonState();
        return;
      }

      setGuessStatus("Checking pairing…", null);

      try {
        const url =
          SCRIPT_URL +
          "?action=checkPair&code=" +
          encodeURIComponent(currentCode) +
          "&first=" +
          encodeURIComponent(first) +
          "&second=" +
          encodeURIComponent(second);
        const response = await fetch(url);
        const data = await response.json();

        if (data.result === "correct") {
          setGuessStatus(
            `Correct Pairing: ${first} and ${second}`,
            "success"
          );
        } else if (data.result === "incorrect") {
          setGuessStatus(
            `Incorrect Pairing: ${first} and ${second}`,
            "error"
          );
        } else {
          setGuessStatus(
            "Pair could not be checked. Please try again.",
            "error"
          );
        }
      } catch (err) {
        console.error(err);
        setGuessStatus(
          "There was a problem checking the pairing. Please try again.",
          "error"
        );
      }
    }

    // Refresh data from Google Sheets
    async function refreshData() {
      const tbody = document.getElementById("dataTableBody");
      const dataTable = document.getElementById("dataTable");
      const tablePlaceholder = document.getElementById("tablePlaceholder");

      try {
        const url = SCRIPT_URL + "?action=getTokensData";
        const response = await fetch(url);
        const data = await response.json();

        if (!data || data.result !== "ok" || !Array.isArray(data.rows)) {
          console.error("Unexpected response from getTokensData:", data);
          return;
        }

        // Clear any existing rows
        tbody.innerHTML = "";

        // Build a row for each used token
        data.rows.forEach(row => {
          const [code, dateUsed, item1, item2] = row;
          const tr = document.createElement("tr");

          [code, dateUsed, item1, item2].forEach(cellVal => {
            const td = document.createElement("td");
            td.textContent = cellVal || "";
            tr.appendChild(td);
          });

          tbody.appendChild(tr);
        });

        // Hide placeholder and show table
        tablePlaceholder.style.display = "none";
        dataTable.style.display = "table";

        // Update the "Last Refreshed" timestamp
        updateLastRefreshedTime();
      } catch (err) {
        console.error("Error refreshing data:", err);
      }
    }

    function updateLastRefreshedTime() {
      const now = new Date();
      const formattedDate = now.toLocaleDateString('en-US', {
        month: '2-digit',
        day: '2-digit',
        year: 'numeric'
      });
      const formattedTime = now.toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: true
      });
      
      lastRefreshed.textContent = `Last Refreshed: ${formattedDate} ${formattedTime}`;
      lastRefreshed.style.display = 'block';
    }

    // ================= INITIALIZATION =================
    document.addEventListener("DOMContentLoaded", () => {
      // Initialize DOM element references for Pair Checker
      codeInput = document.getElementById("codeInput");
      codeStatus = document.getElementById("codeStatus");
      validateButton = document.getElementById("validateButton");
      selectOne = document.getElementById("selectOne");
      selectTwo = document.getElementById("selectTwo");
      guessButton = document.getElementById("guessButton");
      guessStatus = document.getElementById("guessStatus");
      refreshDataButton = document.getElementById("refreshDataButton");
      lastRefreshed = document.getElementById("lastRefreshed");

      // Populate selectors
      populateSelectors();

      // Set up navigation with password protection
      const navButtons = document.querySelectorAll('.nav-button');
      const pageViews = document.querySelectorAll('.page-view');

      navButtons.forEach(button => {
        button.addEventListener('click', () => {
          const pageNum = button.getAttribute('data-page');
          
          // Check if page requires password and is not unlocked
          if (!unlockedPages[pageNum]) {
            // First update the navigation to show where we're trying to go
            const navButtons = document.querySelectorAll('.nav-button');
            const pageViews = document.querySelectorAll('.page-view');
            
            // Update active state on buttons to show target page
            navButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            // Now show password dialog with correct hint number
            showPasswordDialog(pageNum, navButtons, pageViews);
          } else {
            navigateToPage(pageNum, navButtons, pageViews);
          }
        });
      });

      // Initialize on page 1 (Table of Contents) - but page is locked by default
      // The initial HTML already has page1 and first nav button as active

      // Set up Pair Checker event listeners
      codeInput.addEventListener("input", () => {
        codeIsValid = false;
        setCodeStatus("", null);
        updateValidateButtonState();
        updateGuessButtonState();
      });

      validateButton.addEventListener("click", (e) => {
        e.preventDefault();
        if (!validateButton.disabled) {
          validateCode();
        }
      });

      selectOne.addEventListener("change", () => {
        setGuessStatus("", null);
        updateGuessButtonState();
      });

      selectTwo.addEventListener("change", () => {
        setGuessStatus("", null);
        updateGuessButtonState();
      });

      guessButton.addEventListener("click", (e) => {
        e.preventDefault();
        if (!guessButton.disabled) {
          submitGuess();
        }
      });

      refreshDataButton.addEventListener("click", (e) => {
        e.preventDefault();
        refreshData();
      });
    });

    // Show password dialog for a specific page
    function showPasswordDialog(pageNum, navButtons, pageViews) {
      // Create overlay
      const overlay = document.createElement('div');
      overlay.className = 'password-overlay';
      
      // Create dialog
      const dialog = document.createElement('div');
      dialog.className = 'password-dialog';
      
      // Create input field with placeholder
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = `Enter Password for ${PAGE_NAMES[pageNum]}`;
      input.autocomplete = 'off';
      
      // Handle Enter key
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          checkPassword(pageNum, input.value, overlay, navButtons, pageViews);
        }
      });
      
      dialog.appendChild(input);
      overlay.appendChild(dialog);
      document.body.appendChild(overlay);
      
      // Focus the input
      setTimeout(() => input.focus(), 100);
    }

    // Check if password is correct
    function checkPassword(pageNum, enteredPassword, overlay, navButtons, pageViews) {
      const correctPassword = PAGE_PASSWORDS[pageNum];
      
      if (enteredPassword.toLowerCase() === correctPassword) {
        // Password correct - unlock page and navigate
        unlockedPages[pageNum] = true;
        document.body.removeChild(overlay);
        
        navigateToPage(pageNum, navButtons, pageViews);
      } else {
        // Password incorrect - shake the dialog and revert navigation
        const dialog = overlay.querySelector('.password-dialog');
        dialog.style.animation = 'shake 0.3s';
        setTimeout(() => {
          dialog.style.animation = '';
        }, 300);
        
        // Revert navigation to last unlocked page (page 1)
        // Find the last unlocked page to navigate back to
        let lastUnlockedPage = '1';
        for (let i = parseInt(pageNum) - 1; i >= 1; i--) {
          if (unlockedPages[i.toString()]) {
            lastUnlockedPage = i.toString();
            break;
          }
        }
        
        // Revert the active button state
        navButtons.forEach(btn => btn.classList.remove('active'));
        const revertButton = Array.from(navButtons).find(btn => btn.getAttribute('data-page') === lastUnlockedPage);
        if (revertButton) revertButton.classList.add('active');
      }
    }

    // Navigate to a page
    function navigateToPage(pageNum, navButtons, pageViews) {
      // Update active state on buttons
      navButtons.forEach(btn => btn.classList.remove('active'));
      const targetButton = Array.from(navButtons).find(btn => btn.getAttribute('data-page') === pageNum);
      if (targetButton) targetButton.classList.add('active');
      
      // Update active page view
      pageViews.forEach(page => page.classList.remove('active'));
      document.getElementById(`page${pageNum}`).classList.add('active');
    }
  </script>
</body>
</html>
